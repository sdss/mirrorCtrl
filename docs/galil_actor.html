<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
	<title>Galil Actor</title>
</head>
<body>
<h1>Galil Actor</h1>

<ul>
    <li><a href="#Overview">Overview</a>
    <li><a href="#GalCommands">Galil Commands</a>
    <ul>
        <li><a href="#cmd_move">move <i>[piston [,tiltX [,tiltY [,transX [,transY]]]]]</i></a>
        <li><a href="#cmd_home">home <i>[A [,B [,C [,D [,E [,F]]]]]]</i></a>
        <li><a href="#cmd_showparams">showparams</a>
        <li><a href="#cmd_log">log</a>
        <li><a href="#cmd_stop">stop</a>
    </ul>   
    <li><a href="#StdCommands">Inherited TclActor Commands</a>
    <ul>
        <li><a href="#cmd_connDev">connDev <i>[dev1 [dev2 [...]]]</i></a>
        <li><a href="#cmd_disconnDev">disconnDev <i>[dev1 [dev2 [...]]]</i></a>
        <li><a href="#cmd_help">help</a>
        <li><a href="#cmd_exit">exit</a>
        <li><a href="#cmd_ping">ping</a>
        <li><a href="#cmd_status">status</a>
        <p>
        <li><a href="#cmd_debugMsgs">debugMsgs on/off</a>
        <li><a href="#cmd_debugRefCounts">debugRefCounts</a>
        <li><a href="#cmd_debugWing">debugWing</a>
    </ul>
    <li><a href="#StdKeywords">Inherited TclActor Keywords</a>
    <ul>
        <li><a href="#key_devConnState"><i>dev</i>ConnState=<i>state, reason</i></a>
        <li><a href="#key_numUsers">numUsers=<i>int</i></a>
        <li><a href="#key_refCount">refCount=<i>refcount, object</i></a>
        <li><a href="#key_superseded">superseded</a>
        <li><a href="#key_text">text</a>
        <li><a href="#key_timeout">timeout</a>
        <li><a href="#key_unknownCommand">unknownCommand=<i>cmdVerb</i></a>
        <li><a href="#key_userInfo">userInfo=<i>userID1, addr1, userID2, addr2, ...</i></a>
        <li><a href="#key_version">version=<i>vers</i></a>
        <li><a href="#key_yourUserID">yourUserID=<i>int</i></a>
    </ul>
    <li><a href="#VersionHistory">Version History</a>
</ul>

<h2><a name="Overview">Overview</a></h2>

<p>Galil Actor is based on TclActor. This actor sends commands to and parses replies from a
Galil motion controller. The Galil motion controller interfaces with the actuators and encoders 
responsible for moving the mirror.

<p>See <a href="http://www.apo.nmsu.edu/35m_operations/MC2/TclActorInternals.html">TclActor Internals</a> for information about writing code based on TclActor.

<h2><a name="GalCommands">Galil Commands</a></h2>

<h3><a name="cmd_move">move <i>[piston [,tiltX [,tiltY [,transX [,transY]]]]]</i></a></h3>

<p> Move the mirror to the desired orientation.  Units are um for lengths and arcseconds for angles. 
Arguments must appear in the exact order.  If fewer than 5 axes are specified, remaining axes are assumed to be 0. 
At least 1 axis (piston) must be specified.
Once a move command is received, a desired 6-axis orientation is determined based on constrained axes 
(eg an anti-rotation link). So rotation about the Z axis may never be directly commanded, but it may 
manifest as an induced effect. 
<p>If encoders are present, an error between actual and desired orientation is computed. 
 Up to X subsequent moves may be automatically commanded in effort to minimize this error.
</p>
<p>Note: the 3.5m M3 may not be commanded to translate.
</p>

<h3><a name="cmd_home">home <i>[A [,B [,C [,D [,E [,F]]]]]]</i></a></h3>

<p> Home the desired axes. Axis arguments may be in any order or omitted. 
If no axis arguments are passed, all valid axes are homed.  
<ul>
    <li>2.5m M1 valid axes: A-F 
    <li>2.5m M2 valid axes: A-E
    <li>3.5m M2 valid axes: A-E
    <li>3.5m M3 valid axes: A-C
</ul>
</p>

<h3><a name="cmd_showparams">showparams</a></h3>

<p>
Quieries the Galil for it's parameters. See <a href="http://www.apo.nmsu.edu/Telescopes/HardwareControllers/GalilMirrorControllers.html"> Galil Documentation</a> for more info.
</p>

<h3><a name="cmd_showparams">log</a></h3>

<p>
Spits out each raw line received from the Galil since startup via the 'Text' keyword
</p>

<h3><a name="cmd_stop">stop</a></h3>

<p>
Sends a stop command. Any running commands will stop, and the status of the Galil will be returned.
</p>


<h2><a name="StdCommands">Inherited TclActor Commands</a></h2>

<p>All actors based on TclActor typically support the following standard commands (plus additional device-specific commands documented in that actor's manual). Commands are not case-sensitive.

<h3><a name="cmd_connDev">connDev <i>[dev1 [dev2 [...]]]</i></a></h3>

<p>Connect one or more devices (if not already connected). The default is to connect all devices that are not already connected.

<h3><a name="cmd_disconnDev">disconnDev <i>[dev1 [dev2 [...]]]</i></a></h3>

<p>Disconnect one or more devices (if not already disconnected). The default is to disconnect all devices that are not already disconnected.

<h3><a name="cmd_help">help</a></h3>

<p>Print a brief description of each command.

<h3><a name="cmd_exit">exit</a></h3>

<p>Log yourself out.

<h3><a name="cmd_ping">ping</a></h3>

<p>Return a short message to indicate that the controller is alive.

<h3><a name="cmd_status">status</a></h3>

<p>Print current status, including user information, the connection state of any devices that are not connected and any additional information that is specific to the actor.

<h3><a name="cmd_debugMsgs">debugMsgs</a> on/off</h3>

<p>Turn debugging messages on or off (for all users).

<h3><a name="cmd_debugRefCounts">debugRefCounts</a></h3>

<p>Display the reference count for each object (in descending reference count) using keyword <a href="#key_refCount">refCount</a>.

<h3><a name="cmd_debugWing">debugWing</a></h3>

<p>Enable debugging via WingIDE (simply imports wingdbstubs).

<h2><a name="GalKeywords"></a>Galil Keywords</h2>

<h3><a name="key_DesOrient"></a>DesOrient=float,float,float,float,float,float</h3>
<p>
The desired mirror orientation: piston (um), tiltX (arcsec), tiltY (arcsec), 
transX (um), transY (um), rotZ (arcsec) in um and arcseconds.
</p>
<h3><a name="key_DesOrientAge"></a>DesOrientAge=float</h3>
<p>
Elapsed time (seconds) since a desired orientation was set.
</p>

<h3><a name="key_CmdMount"></a>CmdMount=float*nAct</h3>
<p>Commanded mount positions
</p>
<h3><a name="key_Cmd"></a>Cmd=String</h3>
<p>The current command (verb) executing.
</p>
<h3><a name="key_MaxDuration"></a>MaxDuration=float</h3>
<p>Maximum amount of time (seconds) expected for current process.
</p>
<h3><a name="key_Duration"></a>Duration=float</h3>
<p>Time (seconds) spent executing so far
</p>
<h3><a name="key_Text"></a>Text=string</h3>
<p>Text for humans to read
</p>
<h3><a name="key_Orient"></a>Orient=float,float,float,float,float,float</h3>
<p>The measured or actual mirror orientation: piston (um), tiltX (arcsec), tiltY (arcsec), 
transX (um), transY (um), rotZ (arcsec) in um and arcseconds.
</p>
<h3><a name="key_ActMount"></a>ActMount=float*nAct</h3>
<p>The measured or actual actuator mount positions.
</p>
<h3><a name="key_Iter"></a>Iter=int</h3>
<p>Current move iteration.
</p>
<h3><a name="key_AxisHomed"></a>AxisHomed=bool*nAct</h3>
<p>Axes that are homed
</p>
<h3><a name="key_Status"></a>Status=32bits*nAct</h3>
<p>See <a href"http://www.apo.nmsu.edu/Telescopes/HardwareControllers/GalilMirrorControllers.html#StatusWord"> Galil status word</a>
</p>
<h3><a name="key_MaxIter"></a>MaxIter=int</h3>
<p>Max number of allowed iterations for a move.
</p>
<h3><a name="key_Homing"></a>Homing=bool*nAct</h3>
<p>Axes that are homing
</p>
<h3><a name="key_UnparsedReply"></a>UnparsedReply=string*(1,2)</h3>
<p>Display an ignored raw Galil reply
</p>
<h3><a name="key_BadGalilReply"></a>BadGalilReply=string*(1,2)</h3>
<p>Parsed Galil reply that confused the actor
</p>
<h3><a name="key_GParSoftwareVersion"></a>GParSoftwareVersion=float</h3>
<p>Software Version, Galil Param
</p>
<h3><a name="key_GParNAXES"></a>GParNAXES=int</h3>
<p>Number of axes (1-6), Galil Param
</p>
<h3><a name="key_GParDOAUX"></a>GParDOAUX=int</h3>
<p>If nonzero, status info emitted from aux serial port, http://www.apo.nmsu.edu/Telescopes/HardwareControllers/GalilMirrorControllers.html#InterfaceAuxPortStatus, Galil Param.
</p>
<h3><a name="key_GParMOFF"></a>GParMOFF=int</h3>
<p>Turn off all motors after each move, if nonzero.
</p>
<h3><a name="key_GParNCORR"></a>GParNCORR=int</h3>
<p>Number of encoder-based corrections after each move
</p>
<h3><a name="key_GParWTIME"></a>GParWTIME=float</h3>
<p>Settling time after a move
</p>
<h3><a name="key_GParENCTIME"></a>GParENCTIME=float</h3>
<p>Settling time after a move and after WTIME, before encoders are read
</p>
<h3><a name="key_GParLSTIME"></a>GParLSTIME=float</h3>
<p>Max time required to back out of a limit at low speed
</p>
<h3><a name="key_GPar_RNGxdiv2"></a>GPar_RNGxdiv2=int*nAct</h3>
<p>Half the negative range in microsteps
</p>
<h3><a name="key_GParRNGxdiv2"></a>GParRNGxdiv2=int*nAct</h3>
<p>Half the positive range in microsteps
</p>
<h3><a name="key_GParSPDx"></a>GParSPDx=int*nAct</h3>
<p>Max speed, in microsteps/sec
</p>
<h3><a name="key_GParHMSPDx"></a>GParHMSPDx=int*nAct</h3>
<p>Max speed for finding home switch, in microsteps/sec
</p>
<h3><a name="key_GParACCx"></a>GParACCx=int*nAct</h3>
<p>Acceleration and deceleration of each axis, in microsteps/sec^2
</p>
<h3><a name="key_GParMINCORRx"></a>GParMINCORRx=int*nAct</h3>
<p>The min error that will be corrected, 0 means correct any error
</p>
<h3><a name="key_GParMAXCORRx"></a>GParMAXCORRx=int*nAct</h3>
<p>The max error that will be corrected at the end of a move. Set to 0 if no encoder or no correction is desired
</p>
<h3><a name="key_GParST_FSx"></a>GParST_FSx=int*nAct</h3>
<p>Step resolution, in microsteps per full step. 1 for servo motor
</p>
<h3><a name="key_GParMARGx"></a>GParMARGx=int*nAct</h3>
<p>Margin between the hard and soft reverse limits, in microsteps
</p>
<h3><a name="key_GParINDSEP"></a>GParINDSEP=int*nAct</h3>
<p>If this axis has an index pulse encoder and it is used for homing, then set to the separation between index pulses in microsteps
</p>
<h3><a name="key_GParENCRESx"></a>GParENCRESx=float*nAct</h3>
<p>Resolution of encremental auxiliary encoder in ticks per microstep, 0 if no encoder
</p>

<h2><a name="StdKeywords"></a>Inherited TclActor Keywords</h2>

<p>Keyword data is output whenever the state of the actor changes. All actors based on TclActor output the following standard keywords (in addition to device-specific keywords described in the manual for that actor).

<p>Notes:
<ul>
    <li><i>Dev</i> is a placeholder for a device name
    <li>Numeric values (even integers) will be "NaN" if unknown
    <li>When you first connect you are shown current status, including <a href="key_yourUserID">yourUserID</a>.
</ul>

<h3><a name="key_devConnState"></a><i>dev</i>ConnState=<i>state, reason</i></h3>

<p>State of connection to the dev hardware controller. <i>State</i> is one of Connecting, Authorizing, Connected, Disconnecting, Failing, Disconnected or Failed (the states of an RO.Comm.TCPConnection object). <i>Reason</i> is the reason it got to this state ("" if no reason specified).

<h3><a name="key_numUsers"></a>numUsers=<i>int</i></h3>

<p>The number of users presently connected (a single integer)

<h3><a name="key_refCount">refCount=<i>refcount, object</i></a></h3>

<p>The reference count for an object.

<h3><a name="key_superseded"></a>superseded</h3>

<p>The command was superseded by some other command.

<h3><a name="key_text"></a>text</h3>

<p>Text message (intended for debugging and human consumption).

<h3><a name="key_timeout"></a>timeout</h3>

<p>The command timed out.

<h3><a name="key_unknownCommand">unknownCommand=<i>cmdVerb</i></a></h3>

<p>The command verb (the first word of your command string) is not supported by this actor.

<h3><a name="key_userInfo"></a>userInfo=<i>userID1, addr1, userID2, addr2, ...</i></h3>

<p>An variable-length array containing two entries for each user who is presently connected: userID and the IP address. The user ID is an integer and the address is a string. The userIDs will appear in sorted order but are not necessarily contiguous.

<h3><a name="key_version">version=<i>vers</i></a></h3>

<p>The version number (as a string) of the actor.

<h3><a name="key_yourUserID"></a>yourUserID=<i>int</i></h3>

<p>Your own userID.

<h2><a name="VersionHistory">Version History</a></h2>

<h3>1.0 2012-02-29</h3>

<p>First release.

</body>
</html>
