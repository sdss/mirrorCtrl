<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
	<title>Mirror Controller Actor</title>
</head>
<body>
<h1>Mirror Controller Actor</h1>

<ul>
    <li><a href="#Overview">Overview</a>
    <li><a href="#Commands">Commands</a>
    <ul>
        <li><a href="#cmd_connDev">connDev</a>
        <li><a href="#cmd_disconnDev">disconnDev</a>
        <li><a href="#cmd_exit">exit</a>
        <li><a href="#cmd_galil">galil <i>Galil command</i></a>
        <li><a href="#cmd_home">home <i>[actuatorList]</i></a>
        <li><a href="#cmd_move">move <i>[piston [,tiltX [,tiltY [,transX [,transY]]]]]</i></a>
        <li><a href="#cmd_offset">offset <i>[piston [,tiltX [,tiltY [,transX [,transY]]]]]</i></a>
        <li><a href="#cmd_showparams">showparams</a>
        <li><a href="#cmd_status">status</a>
        <li><a href="#cmd_init">init</a> (or stop, a deprecated alias)
    </ul>
    <li><a href="messageKeywords.html">Keywords</a>
    <ul>
        <li><a href="#updateKeywordManual">Updating the keyword manual</a>
    </ul>
    <li><a href="http://www.apo.nmsu.edu/Telescopes/HardwareControllers/GalilMirrorControllers.html#DeviceSpecific">Mirror-specific information</a> for Apache Point Observatory.
    <li><a href="#installation">Installation Instructions</a>
    <li><a href="#logFiles">Log Files</a>
    <li><a href="html/index.html">Source code documentation</a> generated by Doxygen.
    <li><a href="license.txt">Software license</a>
    <li><a href="versionHistory.html">Version History</a>
</ul>

<h2><a name="Overview">Overview</a></h2>

<p>The mirrorCtrl mirror controller actor controls one telescope mirror. It accepts desired orientation and commands mirror motion accordingly.

<p>Information on directly commanding mirrors from the TCC can be found <a href="http://www.apo.nmsu.edu/Telescopes/TCC/OperatorsManual.html">here</a>

<p>mirrorCtrl is written in pure python. It is presently designed to command a <a href="http://www.apo.nmsu.edu/Telescopes/HardwareControllers/GalilMirrorControllers.html">Galil mirror controller</a>, but one may add support for other low-level motion controllers.

<p>mirrorCtrl is written pure Python. <a href="html/index.html">Source code documentation</a> is available, generated by Doxygen.

<h2><a name="Commands">Commands</a></h2>

<h3><a name="cmd_connDev"> connDev </a></h3>

<p>Connect the mirror controller to the galil. This command will be necessary after talk2boxes is used.

<h3><a name="cmd_disconnDev"> disconnDev </a></h3>

<p>Disconnect the mirror controller from the galil.

<h3><a name="cmd_exit"> exit </a></h3>

<p>Disconnect yourself from the mirror controller.

<h3><a name="cmd_galil">galil <i>Galil Command</i></a></h3>

<p>Send an arbitrary Galil command to the <a href="GalilMirrorControllers.html">Galil mirror controller</a>. The command may include spaces and punctuation, as needed. The command need not be surrounded by double quotes, but if you do provide them, they will be ignored.

<p>Example Galil commands:
<ul>
    <li><code>galil A=1; B=1; C=1; XQ#HOME</code> (though the command <a href="cmd_home">home</a> is easier and safer)
    <li><code>galil MG MARGA</code> will print the value of variable <code>MARGA</code> (though the command <a href="cmd_showparams">showparams</a> is easier)
</ul>

<p>Note: this command attempts to be clever about making sure it sees a terminating <code>OK</code> from the Galil. If your command includes an <code>XQ#...</code> command, or if your command ends with <code>MG "OK"</code> then it passes the command along "as is"; otherwise it appends <code>; MG "OK"</code> to your command.

<h3><a name="cmd_home">home <i>[actuatorList]</i></a></h3>

<p>Home the desired actuators, where actuator list is a comma-separated list of actuator letters A through F (but some mirrors have fewer than 6 actuators). If no axes are specified, all axes are homed:
<ul>
    <li>2.5m M1 valid actuators: A-F
    <li>2.5m M2 valid actuators: A-E
    <li>3.5m M2 valid actuators: A-E
    <li>3.5m M3 valid actuators: A-C
</ul>

<p><b>Warning:</b> this command typically takes a very long time and typically shoul be performed with the telescope at a specific altitude.

<h3><a name="cmd_move">move <i>[piston [,tiltX [,tiltY [,transX [,transY]]]]]</i></a></h3>

<p>Move the mirror to the desired orientation. Units are um for lengths and arcseconds for angles. Arguments may only appear in the exact order listed above. If fewer than 5 axes are specified, the remaining non-specified axes are assumed to be zero. At least 1 axis (piston) must be specified for a valid command.

<p>You may not command orientation for constrained axes (e.g. rotation about Z). Most mirrors have 5 degrees of freedom, but a few only have 3.

<p>In detail, moves are performed as follows:
<ul>
    <li>Compute the orientation for constrained axes, resulting in a full 6 axis desired orientation.
    <li>Compute desired encoder lengths (for axes without encoders, this is the commanded mount position).
    <li>Compute predicted actuator.
    <li>Repeat the following until the number of iterations exceeds some maximum or the encoder error is sufficiently small:
    <ul>
        <li>Move the actuators.
        <li>Read the encoders and compute encoder error (actual - desired encoder length).
        <li>Use the encoder error to compute an actuator length correction.
    </ul>
</ul>

<h3><a name="cmd_offset">offset <i>[piston [,tiltX [,tiltY [,transX [,transY]]]]]</i></a></h3>

<p>Offset the mirror orientation by the desired amount. Units are um for lengths and arcseconds for angles. Arguments may only appear in the exact order listed above. If fewer than 5 axes are specified, the remaining non-specified axes are assumed to be zero. At least 1 axis (piston) must be specified for a valid command.

<p>See <a href="#cmd_move">move</a> for more information.

<h3><a name="cmd_showparams">showparams</a></h3>

<p>Query the Galil for parameters. See <a href="http://www.apo.nmsu.edu/Telescopes/HardwareControllers/GalilMirrorControllers.html">Galil Documentation</a> for more info.

<h3><a name="cmd_init">init</a> (or stop, a deprecated alias)</h3>

<p>Reconnect the Galil, if disconnected, stop motion and any executing commands, and return status.

<h3><a name="cmd_status">status</a></h3>

<p>Query the Galil for status.

<h2><a name="updateKeywordManual">Updating the keyword manual</a></h2>

<p>The keyword manual <code>doc/messageKeywords.html</code> is auto-generated from the <code>mirror.py</code> file in the actorkeys package. To generate a new copy:
<ul>
    <li><code>$ setup mirrorCtrl</code>
    <li><code>$ cd $MIRRORCTRL_DIR</code>
    <li><code>$ACTORKEYS_DIR/doc/describe.py --actor mirror --tohtml messageKeywords.html</code>
</ul>

<p>The default title and header are simply "mirror"; I recommend manually changing those two instances to "mirror controller keywords".

<h2><a name="installation">Installation Instructions</a></h2>

<p>The following packages are required:
<ul>
    <li><a href="file:///Users/rowen/TCC/code/twistedActor">twistedActor</a>
</ul>

<p>The following packages are optional:
<ul>
    <li>eups (from LSST): mirrorCtrl may be managed using eups
    <li>sconsUtils (from LSST): mirrorCtrl is pure python, so it need not be built or installed, but if you build it with scons then documentation is built and unit tests are run.
</ul>

<p>The simplest way to build this package is:
<ul>
    <li><a href="https://dev.lsstcorp.org/trac/wiki/Installing">Install the minimal LSST software stack</a>, which includes eups and sconsUtils.
    <li>Install twistedActor
    <li>Use "eups declare -r ." to declare this package
    <li>Use "scons" to build it
    <li>Use "eups declare -r . mirrorCtrl git --current" to declare it or "scons install" to install it (either is fine).
</ul>

<h2><a name="logFiles">Log Files</a></h2>

<p>Log files for the 3.5m mirror controller actors are kept on hub35m in the directory /home/tron/logs/tcc35m/.

</body>
</html>



